# 🎮 交互式版本说明

## 🆕 新版本特性

**版本**：v4.0 - 交互式控制版  
**完成时间**：2025-10-31

根据你的需求，新版本支持：
1. ✅ 实时推送/暂停切换
2. ✅ 手动获取数据
3. ✅ 技术分析（获取历史K线数据）

---

## 🎯 新功能详解

### 1. 双模式切换

**实时推送模式**：
- WebSocket自动推送价格更新
- 数据实时刷新
- 无需手动操作

**暂停模式**：
- 停止接收实时推送
- 按需手动刷新
- 节省资源

**切换方式**：按`空格键`

### 2. 手动刷新数据

**功能**：一键获取最新价格数据

**使用方式**：按`R键`

**特点**：
- 使用REST API获取
- 立即返回最新数据
- 适合暂停模式下使用

### 3. 技术分析功能

**功能**：获取历史数据并进行分析

**使用方式**：按`A键`

**执行流程**：
1. 获取历史K线数据（最近24小时，1小时K线）
2. 获取当前实时价格数据
3. 显示K线数据摘要
4. 预留技术指标计算接口

**K线数据包含**：
- 开盘价、最高价、最低价、收盘价
- 成交量、成交额
- 成交笔数
- 统计信息（期间最高/最低/价格变化）

---

## 🎮 控制说明

### 按键控制

| 按键 | 功能 | 说明 |
|------|------|------|
| `空格` | 切换模式 | 实时推送 ↔ 暂停 |
| `R` | 手动刷新 | 获取最新数据 |
| `A` | 技术分析 | 获取历史数据+分析 |
| `Q` | 退出程序 | 安全退出 |

### 界面说明

```
================================================================================
                      >>> 加密货币智能监测系统 <<<
================================================================================

更新时间: 2025-10-31 23:45:30
数据源: 币安WebSocket + REST API
模式: 实时推送中  ← 当前模式

================================================================================

【BTC】
  当前价格:      $110,783.29
  24小时涨跌:    ▲ +2.65% (涨)
  ...

================================================================================
控制面板:
  [空格] 切换实时/暂停模式  实时推送中
  [R]     手动刷新数据
  [A]     技术分析（获取历史数据）
  [Q]     退出程序
================================================================================
```

---

## 📁 新增文件

### 1. `src/binance_kline.py`

**功能**：K线历史数据获取模块

**核心方法**：
```python
# 获取K线数据
get_klines(symbol, interval="1h", limit=100)

# 批量获取多个币种
get_klines_for_multiple_symbols(symbols, interval, limit)

# 获取当前价格（REST API）
get_current_price(symbol)

# 格式化K线摘要
format_klines_summary(symbol, klines)
```

**支持的K线周期**：
- 分钟：1m, 3m, 5m, 15m, 30m
- 小时：1h, 2h, 4h, 6h, 8h, 12h
- 天：1d, 3d
- 周：1w
- 月：1M

### 2. `cli_app_interactive.py`

**功能**：交互式主应用程序

**特性**：
- 多线程架构（WebSocket + 键盘监听 + 显示）
- 实时/暂停模式切换
- 手动刷新功能
- 技术分析功能

---

## 🚀 使用方法

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行交互式版本

```bash
python cli_app_interactive.py
```

### 使用流程

1. **启动应用**
   - 自动连接WebSocket
   - 开始接收实时数据

2. **实时监控**
   - 默认实时推送模式
   - 数据自动更新
   - 每3秒刷新显示

3. **切换模式**
   - 按`空格键`暂停实时推送
   - 再按`空格键`恢复

4. **手动刷新**
   - 暂停模式下按`R键`
   - 立即获取最新数据

5. **技术分析**
   - 按`A键`
   - 自动获取24小时K线数据
   - 显示详细统计信息
   - 预留技术指标接口

6. **退出程序**
   - 按`Q键`或`Ctrl+C`

---

## 📊 技术分析示例输出

```
正在进行技术分析...

1. 获取历史K线数据（最近24小时）...

正在获取 BTC 的K线数据...

【BTCUSDT K线数据摘要】
  数据周期: 24 根K线
  最新价格: $110,783.29
  期间最高: $111,500.00
  期间最低: $108,200.00
  价格变化: +2.35%
  总成交量: 15,234.56
  总成交笔数: 1,234,567

2. 获取当前实时数据...
✓ 数据刷新完成

3. 当前价格信息:
【BTC】
  当前价格:      $110,783.29
  24小时涨跌:    ▲ +2.65% (涨)
  ...

================================================================================
技术分析功能:
• KDJ指标 - 开发中...
• MACD指标 - 开发中...
• BOLL布林带 - 开发中...
• MA均线 - 开发中...
================================================================================

分析完成！按任意键返回...
```

---

## 🔧 技术实现

### 数据获取方式

| 场景 | 方式 | API | 特点 |
|------|------|-----|------|
| 实时推送 | WebSocket | `@ticker` | 实时更新，延迟<100ms |
| 手动刷新 | REST API | `/api/v3/ticker/24hr` | 一次性获取最新数据 |
| K线数据 | REST API | `/api/v3/klines` | 获取历史OHLCV数据 |

### 多线程架构

```
主线程
  ├─ WebSocket线程（实时推送）
  ├─ 键盘监听线程（Windows）
  └─ 显示线程（界面刷新）
```

### 模式切换机制

```python
# 全局变量控制
realtime_mode = True/False

# WebSocket回调中检查
def on_price_update(symbol, data):
    if realtime_mode:  # 只在实时模式下更新
        latest_data[symbol] = data
```

---

## 📚 API参考

### 币安REST API

根据[币安WebSocket文档](https://developers.binance.com/docs/binance-spot-api-docs/web-socket-streams)，我们使用：

**K线数据API**：
```
GET /api/v3/klines
参数:
  - symbol: 交易对（如BTCUSDT）
  - interval: K线周期（如1h）
  - limit: 数量（默认500，最大1000）
```

**24小时Ticker API**：
```
GET /api/v3/ticker/24hr
参数:
  - symbol: 交易对
```

### WebSocket流

**24小时Ticker流**：
```
wss://stream.binance.com:9443/stream?streams=btcusdt@ticker
```

---

## 🎯 使用场景

### 场景1：日常监控

1. 启动应用（实时模式）
2. 观察价格变化
3. 需要时切换暂停

### 场景2：详细分析

1. 按`A键`进入分析模式
2. 查看K线数据
3. 观察价格趋势
4. （未来）查看技术指标

### 场景3：节省资源

1. 按`空格键`暂停实时推送
2. 需要时按`R键`手动刷新
3. 减少网络和CPU占用

---

## ⚙️ 配置说明

配置文件：`config/config.yaml`

```yaml
# 监测的币种列表
cryptocurrencies:
  - BTC
  - ETH
  - SOL
  - DOGE

# 币安配置
binance:
  ws_url: "wss://stream.binance.com:9443"
  api_url: "https://api.binance.com"
  symbol_map:
    BTC: "BTCUSDT"
    ETH: "ETHUSDT"
    SOL: "SOLUSDT"
    DOGE: "DOGEUSDT"
```

---

## 🔮 技术指标规划

### 计划实现的指标

根据你的需求，后续将实现：

1. **KDJ指标**
   - K值、D值、J值计算
   - 超买超卖判断

2. **MACD指标**
   - DIF、DEA、MACD柱
   - 金叉死叉信号

3. **布林带（BOLL）**
   - 上轨、中轨、下轨
   - 波动率分析

4. **移动平均线（MA）**
   - MA5、MA10、MA20、MA30
   - 趋势判断

5. **VOL成交量**
   - 量价配合分析
   - 异常成交量识别

### 实现方式

```python
# 未来的技术指标模块
from src.indicators import TechnicalIndicators

indicators = TechnicalIndicators()

# 基于K线数据计算
kdj = indicators.calculate_kdj(klines)
macd = indicators.calculate_macd(klines)
boll = indicators.calculate_boll(klines)
ma = indicators.calculate_ma(klines, periods=[5,10,20,30])
```

---

## ✅ 功能清单

### 已实现

- [x] 实时WebSocket推送
- [x] 实时/暂停模式切换
- [x] 手动刷新数据
- [x] K线历史数据获取
- [x] K线数据摘要显示
- [x] 键盘交互控制
- [x] 多线程架构
- [x] 技术分析入口

### 待实现

- [ ] KDJ指标计算
- [ ] MACD指标计算
- [ ] BOLL布林带计算
- [ ] MA均线计算
- [ ] VOL成交量分析
- [ ] 买卖信号判断
- [ ] K线图ASCII显示
- [ ] 更多K线周期选择

---

## 💡 使用建议

### 推荐配置

**实时监控**：
- 保持实时模式
- 观察价格波动
- 快速反应

**深度分析**：
- 切换到暂停模式
- 按`A键`获取历史数据
- 仔细分析趋势

**节省资源**：
- 暂停实时推送
- 定期手动刷新
- 降低系统负载

---

## 📝 注意事项

### Windows系统

- ✅ 完整支持所有功能
- ✅ 键盘控制正常工作

### Linux/Mac系统

- ⚠️ 键盘控制不可用
- ✅ WebSocket实时推送正常
- ✅ 手动刷新和分析功能正常

### API速率限制

- REST API：1200次/分钟
- WebSocket：无限制
- 建议：优先使用WebSocket

---

## 🎉 总结

新版本完美实现了你的需求：

✅ **按键切换模式**：实时推送 ↔ 暂停  
✅ **手动获取数据**：按需刷新  
✅ **技术分析**：获取历史K线数据  
✅ **预留接口**：为技术指标计算做好准备  

立即体验：
```bash
python cli_app_interactive.py
```

按`A键`即可获取历史数据并查看分析结果！📊

