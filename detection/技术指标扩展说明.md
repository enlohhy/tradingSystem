# 技术指标扩展说明

## 概述

根据项目需求，后续将添加技术指标分析功能。本文档说明了计划实现的技术指标及其实现思路。

## 计划实现的技术指标

### 1. KDJ指标（随机指标）
**用途**：判断超买超卖状态
- K值：快速确认线
- D值：慢速主干线  
- J值：方向敏感线

**判断标准**：
- K值 > 80：超买区
- K值 < 20：超卖区
- 金叉/死叉信号

### 2. MACD指标（指数平滑异同移动平均线）
**用途**：判断趋势强弱和转折点
- DIF线：快线
- DEA线：慢线
- MACD柱状图：差值

**判断标准**：
- DIF上穿DEA：买入信号（金叉）
- DIF下穿DEA：卖出信号（死叉）
- 柱状图变化：动能强弱

### 3. VOL指标（成交量）
**用途**：确认价格走势的可靠性
- 量价配合：价涨量增为健康走势
- 量价背离：可能出现反转

### 4. K线形态
**用途**：识别价格走势模式
- 阳线/阴线
- 实体和影线比例
- 特殊形态（十字星、锤子线等）

### 5. BOLL指标（布林带）
**用途**：判断价格波动范围
- 上轨：压力位
- 中轨：移动平均线
- 下轨：支撑位

**判断标准**：
- 价格触及上轨：可能回调
- 价格触及下轨：可能反弹
- 带宽收窄：可能出现大行情

### 6. MA指标（移动平均线）
**用途**：判断趋势方向
- MA5：短期趋势
- MA10：中期趋势
- MA20/MA30：长期趋势

**判断标准**：
- 金叉：短期均线上穿长期均线（买入信号）
- 死叉：短期均线下穿长期均线（卖出信号）

## 实现思路

### 数据获取模块扩展

```python
class AdvancedDataFetcher(CryptoDataFetcher):
    """扩展的数据获取器，支持历史数据"""
    
    def get_historical_data(self, coin_id, days=30):
        """获取历史价格数据"""
        # 实现历史数据获取
        pass
    
    def get_ohlc_data(self, coin_id, days=30):
        """获取OHLC数据（开盘价、最高价、最低价、收盘价）"""
        # 实现OHLC数据获取
        pass
```

### 技术指标计算模块

```python
# 新建文件: src/indicators.py

class TechnicalIndicators:
    """技术指标计算类"""
    
    @staticmethod
    def calculate_kdj(high, low, close, period=9):
        """计算KDJ指标"""
        # 实现KDJ计算
        pass
    
    @staticmethod
    def calculate_macd(prices, fast=12, slow=26, signal=9):
        """计算MACD指标"""
        # 实现MACD计算
        pass
    
    @staticmethod
    def calculate_boll(prices, period=20, std_dev=2):
        """计算布林带"""
        # 实现BOLL计算
        pass
    
    @staticmethod
    def calculate_ma(prices, period):
        """计算移动平均线"""
        # 实现MA计算
        pass
```

### 可视化展示模块

```python
# 扩展 cli_app.py

def print_indicators(coin_data, indicators):
    """显示技术指标"""
    print(f"\n【技术指标】")
    print(f"  KDJ: K={indicators['K']:.2f} D={indicators['D']:.2f} J={indicators['J']:.2f}")
    print(f"  MACD: DIF={indicators['DIF']:.2f} DEA={indicators['DEA']:.2f}")
    print(f"  BOLL: 上轨={indicators['upper']:.2f} 中轨={indicators['middle']:.2f} 下轨={indicators['lower']:.2f}")
    
    # 显示交易信号
    if indicators['signal'] == 'buy':
        print(f"  信号: {Fore.GREEN}买入{Style.RESET_ALL}")
    elif indicators['signal'] == 'sell':
        print(f"  信号: {Fore.RED}卖出{Style.RESET_ALL}")
    else:
        print(f"  信号: {Fore.YELLOW}观望{Style.RESET_ALL}")
```

## 所需依赖

```txt
# 添加到 requirements.txt
numpy>=1.20.0          # 数值计算
pandas>=1.3.0          # 数据处理
ta-lib>=0.4.0          # 技术指标库（可选）
```

## 数据源选择

### 方案1：CoinGecko API
- **优点**：免费，稳定
- **缺点**：历史数据有限，更新频率较低
- **适用场景**：长期趋势分析

### 方案2：交易所API（Binance/OKX）
- **优点**：实时K线数据，精度高
- **缺点**：需要API密钥，有速率限制
- **适用场景**：短期交易分析

### 方案3：混合方案
- 使用CoinGecko获取基本信息
- 使用交易所API获取K线数据
- 本地缓存减少API调用

## 实现步骤

### 第一阶段：数据获取
1. 实现历史数据获取接口
2. 实现OHLC数据解析
3. 添加数据缓存机制

### 第二阶段：指标计算
1. 实现基础指标计算（MA、VOL）
2. 实现高级指标（KDJ、MACD、BOLL）
3. 添加指标测试用例

### 第三阶段：信号生成
1. 实现买卖信号判断逻辑
2. 添加多指标综合判断
3. 实现信号强度评分

### 第四阶段：可视化展示
1. 文字形式展示指标数值
2. ASCII艺术K线图
3. 信号提示和建议

## 配置文件扩展

```yaml
# config/config.yaml 扩展

# 技术指标配置
indicators:
  enabled: true
  
  # KDJ参数
  kdj:
    period: 9
    
  # MACD参数
  macd:
    fast: 12
    slow: 26
    signal: 9
    
  # BOLL参数
  boll:
    period: 20
    std_dev: 2
    
  # MA参数
  ma:
    periods: [5, 10, 20, 30]

# 数据更新频率
data:
  realtime_interval: 10      # 实时价格刷新间隔（秒）
  historical_interval: 300   # 历史数据更新间隔（秒）
  cache_days: 30            # 缓存天数
```

## 示例输出（未来）

```
================================================================================
【BTC】
  当前价格:      $109,915.00
  24小时涨跌:    ▲ +1.90% (涨)
  
【技术指标】
  MA5:  $108,500  MA10: $107,200  MA20: $105,800
  KDJ:  K=75.2  D=68.5  J=88.6  (接近超买区)
  MACD: DIF=1250.5  DEA=980.3  MACD柱=270.2 (金叉)
  BOLL: 上轨=$112,000  中轨=$108,000  下轨=$104,000
  
【交易信号】
  综合评分: 75/100
  建议: 谨慎做多，注意上方压力
  
【K线形态】
  最新K线: 阳线（实体占比65%）
  形态特征: 突破前高，量能配合
--------------------------------------------------------------------------------
```

## 注意事项

1. **计算精度**：技术指标需要足够的历史数据支持
2. **信号延迟**：大部分指标都有滞后性
3. **综合判断**：单一指标不可靠，需要多指标配合
4. **风险提示**：技术指标仅供参考，不构成投资建议

## 参考资料

- TA-Lib文档：https://ta-lib.org/
- 技术分析理论书籍
- 各大交易所API文档

---

**当前项目已完成基础价格监测功能，技术指标分析功能将在后续版本中实现。**

