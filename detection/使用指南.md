# 📖 加密货币监测系统 - 完整使用指南

## 目录
1. [版本说明](#版本说明)
2. [快速开始](#快速开始)
3. [功能介绍](#功能介绍)
4. [按键控制](#按键控制)
5. [技术分析](#技术分析)
6. [常见问题](#常见问题)

---

## 版本说明

### v4.0 - 交互式控制版（最新）
✅ **实时推送模式** - WebSocket自动更新  
✅ **暂停模式** - 停止推送，节省资源  
✅ **手动刷新** - 按键获取最新数据  
✅ **技术分析** - 获取历史K线数据  
✅ **键盘控制** - 无需重启切换模式  

### v3.0 - WebSocket版（稳定）
✅ **实时推送** - 币安WebSocket  
✅ **自动更新** - 每3秒刷新显示  
⚠️ **无交互** - 需Ctrl+C退出  

---

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

**依赖包**：
- `requests` - HTTP请求
- `pyyaml` - 配置文件解析
- `colorama` - 终端彩色输出
- `websocket-client` - WebSocket连接

### 2. 选择版本运行

#### 🎮 交互式版本（推荐）

**Windows**:
```bash
启动交互式版本.bat
```

或手动运行：
```bash
python cli_app_interactive.py
```

#### 📺 原版本（简单监控）

**Windows**:
```bash
启动应用.bat
```

或手动运行：
```bash
python cli_app.py
```

---

## 功能介绍

### 🎯 双模式监控

#### 实时推送模式
```
模式: 实时推送中
特点:
  - WebSocket自动推送价格
  - 延迟 < 100ms
  - 无需手动操作
  - 数据实时更新
```

#### 暂停模式
```
模式: 已暂停（按R手动刷新）
特点:
  - 停止接收推送
  - 节省系统资源
  - 按需手动刷新
  - 适合长期挂机
```

### 📊 实时显示

**显示内容**：
- 当前价格
- 24小时涨跌幅（百分比）
- 24小时最高价
- 24小时最低价
- 24小时交易量

**更新频率**：
- 实时模式：即时更新（WebSocket推送）
- 暂停模式：手动刷新（REST API）

### 🔍 技术分析

按`A键`进入技术分析模式：

**执行步骤**：
1. 获取历史K线数据（最近24小时）
2. 获取当前实时价格
3. 显示K线数据摘要
4. 显示当前价格信息
5. 预留技术指标接口

**K线数据信息**：
- 数据周期（K线数量）
- 最新价格
- 期间最高价
- 期间最低价
- 价格变化百分比
- 总成交量
- 总成交笔数

---

## 按键控制

### 控制面板

```
================================================================================
控制面板:
  [空格] 切换实时/暂停模式  实时推送中
  [R]     手动刷新数据
  [A]     技术分析（获取历史数据）
  [Q]     退出程序
================================================================================
```

### 详细说明

| 按键 | 功能 | 使用场景 |
|------|------|----------|
| **空格** | 切换模式 | 切换实时推送↔暂停 |
| **R** | 手动刷新 | 暂停模式下获取最新数据 |
| **A** | 技术分析 | 查看历史K线+技术指标 |
| **Q** | 退出程序 | 安全退出 |
| **Ctrl+C** | 强制退出 | 紧急退出 |

### 使用流程示例

#### 场景1：实时监控
```
1. 启动程序（默认实时模式）
2. 观察价格变化
3. 按Q退出
```

#### 场景2：间歇监控
```
1. 启动程序
2. 按空格键暂停推送
3. 需要时按R刷新数据
4. 观察完毕按Q退出
```

#### 场景3：技术分析
```
1. 启动程序
2. 按A键进入分析
3. 查看K线数据和趋势
4. 按任意键返回主界面
5. 继续监控或退出
```

---

## 技术分析

### 功能说明

按`A键`进入技术分析模式，系统将：

#### 1. 获取历史K线数据

```
【BTCUSDT K线数据摘要】
  数据周期: 24 根K线（1小时周期）
  最新价格: $110,248.38
  期间最高: $111,190.00
  期间最低: $106,304.34
  价格变化: +2.36%
  总成交量: 23,521.63 BTC
  总成交笔数: 5,700,201
```

#### 2. 获取当前价格

```
【BTC】
  当前价格:      $110,248.38
  24小时涨跌:    ▲ +2.39% (涨)
  24小时交易量:  $64,857,273,290
  24小时最高:    $111,190.00
  24小时最低:    $106,304.34
```

#### 3. 技术指标（开发中）

```
技术分析功能:
• KDJ指标 - 开发中...
• MACD指标 - 开发中...
• BOLL布林带 - 开发中...
• MA均线 - 开发中...
```

### K线周期支持

**可用周期**：
- 分钟：1m, 3m, 5m, 15m, 30m
- 小时：1h, 2h, 4h, 6h, 8h, 12h
- 天：1d, 3d
- 周：1w
- 月：1M

**修改方法**（修改源码）：
```python
# 在 cli_app_interactive.py 的 perform_technical_analysis() 函数中
klines = kline_client.get_klines(trading_pair, "1h", 24)  # 修改这里
                                                ^     ^
                                            周期  数量
```

### 数据来源

| 数据类型 | API | 特点 |
|---------|-----|------|
| K线历史数据 | `/api/v3/klines` | 获取OHLCV数据 |
| 当前价格 | `/api/v3/ticker/24hr` | 24小时统计数据 |
| 实时推送 | WebSocket `@ticker` | 实时价格更新 |

---

## 常见问题

### Q1: 如何切换实时/暂停模式？

**答**：按`空格键`即可切换。

**状态显示**：
- 实时推送：`模式: 实时推送中`（绿色）
- 暂停状态：`模式: 已暂停（按R手动刷新）`（黄色）

---

### Q2: 暂停模式下如何更新数据？

**答**：按`R键`手动刷新。

**特点**：
- 使用REST API获取最新数据
- 一次性获取所有币种
- 立即更新显示

---

### Q3: 如何查看历史数据？

**答**：按`A键`进入技术分析模式。

**包含内容**：
- 最近24小时的K线数据
- 当前实时价格
- 统计信息和趋势

---

### Q4: 为什么键盘控制不工作？

**可能原因**：
1. 非Windows系统
   - Linux/Mac不支持`msvcrt`模块
   - 建议使用原版（`cli_app.py`）

2. 程序未获取焦点
   - 点击终端窗口
   - 确保程序在前台

3. 输入法干扰
   - 切换到英文输入
   - 关闭输入法

---

### Q5: 如何添加更多币种？

**答**：修改配置文件 `config/config.yaml`

```yaml
cryptocurrencies:
  - BTC
  - ETH
  - SOL
  - DOGE
  - BNB      # 新增
  - ADA      # 新增

binance:
  symbol_map:
    BTC: "BTCUSDT"
    ETH: "ETHUSDT"
    SOL: "SOLUSDT"
    DOGE: "DOGEUSDT"
    BNB: "BNBUSDT"     # 新增映射
    ADA: "ADAUSDT"     # 新增映射
```

---

### Q6: 如何更改K线周期？

**答**：修改源码 `cli_app_interactive.py`

找到 `perform_technical_analysis()` 函数：

```python
# 原代码
klines = kline_client.get_klines(trading_pair, "1h", 24)

# 改为5分钟K线，最近288根（24小时）
klines = kline_client.get_klines(trading_pair, "5m", 288)

# 改为1天K线，最近30根（30天）
klines = kline_client.get_klines(trading_pair, "1d", 30)
```

---

### Q7: WebSocket连接失败怎么办？

**排查步骤**：

1. **检查网络连接**
   ```bash
   ping api.binance.com
   ```

2. **检查防火墙**
   - 允许程序访问网络
   - 允许WebSocket连接（端口9443）

3. **使用代理**（如果在国内）
   - 可能需要配置代理
   - 或使用VPN

4. **切换到原版**
   ```bash
   python cli_app.py
   ```

---

### Q8: 显示乱码怎么办？

**Windows系统**：

1. 使用提供的bat文件启动
   ```bash
   启动交互式版本.bat
   ```

2. 手动设置编码
   ```bash
   chcp 65001
   python cli_app_interactive.py
   ```

**Linux/Mac系统**：
```bash
export LANG=en_US.UTF-8
python cli_app_interactive.py
```

---

### Q9: API速率限制怎么办？

**币安限制**：
- REST API：1200次/分钟
- WebSocket：无限制

**建议**：
- 优先使用实时推送模式
- 避免频繁手动刷新
- 暂停模式下按需刷新

**如遇限制**：
- 等待1分钟
- 切换到实时推送模式

---

### Q10: 技术指标何时可用？

**当前状态**：
- ✅ K线数据获取 - 已完成
- ✅ 数据摘要显示 - 已完成
- 🚧 技术指标计算 - 开发中

**计划实现**：
1. KDJ指标
2. MACD指标
3. 布林带（BOLL）
4. 移动平均线（MA）
5. 成交量分析（VOL）

**开发优先级**：
- 根据你的需求逐步实现
- 优先开发最常用的指标

---

## 配置说明

### 配置文件：`config/config.yaml`

```yaml
# 监测的币种列表
cryptocurrencies:
  - BTC
  - ETH
  - SOL
  - DOGE

# 币安配置
binance:
  # WebSocket服务器地址
  ws_url: "wss://stream.binance.com:9443"
  
  # REST API地址
  api_url: "https://api.binance.com"
  
  # 交易对映射
  symbol_map:
    BTC: "BTCUSDT"
    ETH: "ETHUSDT"
    SOL: "SOLUSDT"
    DOGE: "DOGEUSDT"
```

### 可配置项

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| `cryptocurrencies` | 监测币种列表 | BTC, ETH, SOL, DOGE |
| `ws_url` | WebSocket地址 | wss://stream.binance.com:9443 |
| `api_url` | REST API地址 | https://api.binance.com |
| `symbol_map` | 币种到交易对映射 | 见配置文件 |

---

## 系统要求

### 最低要求

- **Python**: 3.7+
- **操作系统**: Windows / Linux / macOS
- **内存**: 100MB+
- **网络**: 稳定的互联网连接

### 推荐配置

- **Python**: 3.9+
- **操作系统**: Windows 10/11
- **内存**: 200MB+
- **网络**: 宽带连接

---

## 项目结构

```
detection/
├── cli_app.py                   # 原版应用（简单监控）
├── cli_app_interactive.py       # 交互式版本（推荐）
├── test_kline.py                # K线测试脚本
├── requirements.txt             # 依赖包列表
├── 启动应用.bat                  # 启动原版
├── 启动交互式版本.bat            # 启动交互式版本
├── 使用指南.md                  # 本文档
├── 交互式版本说明.md            # 版本详细说明
├── config/
│   └── config.yaml             # 配置文件
├── src/
│   ├── binance_websocket.py    # WebSocket客户端
│   ├── binance_kline.py        # K线数据获取
│   └── config_loader.py        # 配置加载器
└── rules/
    └── technical_options.mdc   # 技术指标规划
```

---

## 使用建议

### 新手用户

1. 使用`启动应用.bat`开始
2. 观察数据显示
3. 熟悉后尝试交互式版本

### 进阶用户

1. 使用`启动交互式版本.bat`
2. 尝试切换模式
3. 使用技术分析功能
4. 自定义配置文件

### 开发者

1. 阅读源码理解架构
2. 修改K线周期和数量
3. 添加自定义币种
4. 扩展技术指标（即将到来）

---

## API文档参考

### 币安官方文档

- [REST API](https://developers.binance.com/docs/binance-spot-api-docs/rest-api)
- [WebSocket Streams](https://developers.binance.com/docs/binance-spot-api-docs/web-socket-streams)

### 主要API端点

**K线数据**：
```
GET /api/v3/klines
```

**24小时Ticker**：
```
GET /api/v3/ticker/24hr
```

**WebSocket Ticker流**：
```
wss://stream.binance.com:9443/stream?streams=btcusdt@ticker
```

---

## 更新日志

### v4.0 - 2025-10-31
- ✅ 新增交互式控制
- ✅ 实时/暂停模式切换
- ✅ 手动刷新功能
- ✅ 技术分析入口
- ✅ K线历史数据获取

### v3.0 - 2025-10-30
- ✅ 切换到币安WebSocket
- ✅ 移除CoinGecko数据源
- ✅ 优化实时推送性能

### v2.0 - 2025-10-29
- ✅ 添加币安REST API
- ✅ 双数据源支持

### v1.0 - 2025-10-28
- ✅ 初始版本
- ✅ CoinGecko数据获取
- ✅ 基本监控功能

---

## 技术支持

### 遇到问题？

1. 查看[常见问题](#常见问题)
2. 检查配置文件
3. 查看终端错误信息
4. 尝试重启程序

### 功能建议

如有功能建议或技术指标需求，欢迎反馈！

---

## 总结

### 交互式版本特点

✅ **灵活控制** - 按键切换模式  
✅ **节省资源** - 可暂停推送  
✅ **深度分析** - 历史K线数据  
✅ **即将到来** - 技术指标计算  

### 立即开始

```bash
# Windows用户
启动交互式版本.bat

# Linux/Mac用户  
python cli_app_interactive.py
```

按`A键`查看技术分析！📊

